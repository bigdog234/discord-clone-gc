<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Discord‑Style Chat with Login</title>
  <style>
    body { margin:0; font-family: Arial, sans-serif; background:#1e1f22; color:white; }
    .center { display:flex; justify-content:center; align-items:center; height:100vh; }
    .login-box { background:#2b2d31; padding:30px; border-radius:10px; width:320px; }
    input { width:100%; padding:10px; margin-top:10px; border:none; border-radius:5px; }
    button { width:100%; margin-top:15px; padding:10px; background:#5865f2; border:none; border-radius:5px; color:white; cursor:pointer; }
    button:hover { background:#4752c4; }
    /* Chat layout */
    .app { display:flex; height:100vh; }
    .servers { width:80px; background:#1e1f22; padding:10px; overflow-y:auto; }
    .channels { width:250px; background:#2b2d31; padding:10px; overflow-y:auto; }
    .chat { flex:1; display:flex; flex-direction:column; background:#313338; }
    .messages { flex:1; overflow-y:auto; padding:20px; }
    .message { margin-bottom:12px; }
    .sender { font-weight:bold; }
    .input-area { display:flex; padding:10px; background:#2b2d31; }
    .input-area input { flex:1; margin-right:10px; }
  </style>
</head>
<body>

<div id="login" class="center">
  <div class="login-box">
    <h2>Create / Login</h2>
    <input id="username" placeholder="Username" />
    <input id="password" type="password" placeholder="Password" />
    <button onclick="register()">Create Account</button>
    <button onclick="login()">Login</button>
    <p id="login-msg" style="color:#fa5757;"></p>
  </div>
</div>

<div id="app" class="app" style="display:none;">
  <!-- Server List -->
  <div class="servers" id="serverList"></div>

  <!-- Channels Panel -->
  <div class="channels">
    <h3 id="serverName"></h3>
    <div id="channelList"></div>
    <input id="newChannel" placeholder="New channel name" />
    <button onclick="createChannel()">Add Channel</button>
  </div>

  <!-- Chat -->
  <div class="chat">
    <div class="messages" id="messages"></div>
    <div class="input-area">
      <input id="msgInput" placeholder="Message..." />
      <button onclick="sendMessage()">Send</button>
    </div>
  </div>
</div>

<script>
/* —— AI Bad‑word Filter (very simple) —— */
const badWords = ["badword1","badword2","fuck","shit","bitch"];
function cleanName(name){
  for(const w of badWords){
    let reg = new RegExp(w, "gi");
    name = name.replace(reg, "***");
  }
  return name;
}

/* —— Local Storage Structure ——
users = {
  username: { password:"", servers:{ serverCode:{ name:"", channels:{}, }} }
}
*/
let users = JSON.parse(localStorage.getItem("users") || "{}");
let currentUser = null;
let currentServer = null;
let currentChannel = null;

function save(){ localStorage.setItem("users", JSON.stringify(users)); }

function register(){
  let user = cleanName(document.getElementById("username").value.trim());
  let pass = document.getElementById("password").value;
  if(!user || !pass) return msg("Enter username + password");
  if(users[user]) return msg("User already exists");
  users[user] = { password:pass, servers:{} };
  save(); msg("Account created! Login now.");
}

function login(){
  let user = document.getElementById("username").value.trim();
  let pass = document.getElementById("password").value;
  if(!users[user] || users[user].password !== pass) return msg("Wrong username or password");
  currentUser = user;
  document.getElementById("login").style.display="none";
  document.getElementById("app").style.display="flex";
  loadServers();
}

function msg(t){ document.getElementById("login-msg").innerText = t; }

/* —— Servers —— */
function loadServers(){
  let box = document.getElementById("serverList");
  box.innerHTML = "";
  let userData = users[currentUser];
  Object.keys(userData.servers).forEach(code=>{
    let btn = document.createElement("button");
    btn.innerText = code;
    btn.style = "width:100%; margin-bottom:10px; height:50px;";
    btn.onclick = ()=>openServer(code);
    box.appendChild(btn);
  });
  // create new server button
  let add = document.createElement("button");
  add.innerText = "+";
  add.style = "width:100%; height:50px; background:#5865f2;";
  add.onclick = newServer;
  box.appendChild(add);
}

function newServer(){
  let name = prompt("Server Name?");
  if(!name) return;
  name = cleanName(name);
  let code = Math.random().toString(36).substring(2,7);
  users[currentUser].servers[code] = { name:name, channels:{} };
  save(); loadServers();
}

function openServer(code){
  currentServer = code;
  document.getElementById("serverName").innerText = users[currentUser].servers[code].name + " ("+code+")";
  loadChannels();
}

/* —— Channels —— */
function loadChannels(){
  let list = document.getElementById("channelList");
  list.innerHTML = "";
  let chs = users[currentUser].servers[currentServer].channels;
  Object.keys(chs).forEach(ch=>{
    let b = document.createElement("button");
    b.innerText = ch;
    b.style = "width:100%; margin-bottom:6px;";
    b.onclick = ()=>openChannel(ch);
    list.appendChild(b);
  });
}

function createChannel(){
  let name = cleanName(document.getElementById("newChannel").value.trim());
  if(!name) return;
  users[currentUser].servers[currentServer].channels[name] = [];
  save(); loadChannels();
  document.getElementById("newChannel").value = "";
}

function openChannel(ch){ currentChannel = ch; loadMessages(); }

/* —— Messages —— */
function loadMessages(){
  let box = document.getElementById("messages");
  box.innerHTML = "";
  let msgs = users[currentUser].servers[currentServer].channels[currentChannel];
  msgs.forEach(m=>{
    let div = document.createElement("div");
    div.className="message";
    div.innerHTML = `<span class='sender'>${m.user}:</span> ${m.text}`;
    box.appendChild(div);
  });
  box.scrollTop = box.scrollHeight;
}

function sendMessage(){
  let text = document.getElementById("msgInput").value;
  if(!text) return;
  users[currentUser].servers[currentServer].channels[currentChannel].push({ user:currentUser, text:text });
  save();
  document.getElementById("msgInput").value = "";
  loadMessages();
}
</script>

</body>
</html>
