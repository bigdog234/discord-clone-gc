<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Discord‑Style Chat (Working)</title>
  <style>
    :root{
      --bg:#313338; --panel:#2b2d31; --accent:#5865f2; --muted:#9aa0a6; --card:#2b2d31;
      --input:#1e1f22; --white:#e6e6e6;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter,Segoe UI,Roboto,system-ui;}
    body{display:flex;height:100vh;background:var(--bg);color:var(--white)}

    /* left server column */
    .servers{width:72px;background:#1e1f22;padding:12px 8px;display:flex;flex-direction:column;align-items:center;gap:14px}
    .server{width:48px;height:48px;border-radius:12px;background:var(--accent);display:flex;align-items:center;justify-content:center;font-weight:700;cursor:pointer}
    .server.small{background:#2f3136;border-radius:10px;color:var(--muted)}

    /* channels column */
    .channels{width:260px;background:var(--panel);padding:14px;display:flex;flex-direction:column}
    .channels .title{font-weight:700;margin-bottom:8px}
    .channel{padding:8px 10px;border-radius:6px;color:var(--white);opacity:0.9;cursor:pointer;margin-bottom:6px}
    .channel:hover{background:#3b3e44}
    .channel.active{background:#404249}

    /* center chat */
    .chat{flex:1;display:flex;flex-direction:column;background:var(--bg)}
    .chat .header{height:56px;padding:12px 18px;background:var(--panel);border-bottom:1px solid #232428;display:flex;align-items:center;gap:12px}
    .chat .messages{flex:1;padding:18px;overflow:auto}

    .msg{margin-bottom:16px;display:flex;gap:12px;align-items:flex-start}
    .avatar{width:40px;height:40px;border-radius:8px;background:#444;display:flex;align-items:center;justify-content:center;color:var(--white);font-weight:700}
    .bubble{background:var(--card);padding:10px 12px;border-radius:8px;max-width:720px}
    .meta{font-size:13px;color:var(--muted);margin-bottom:6px}

    /* input */
    .composer{padding:12px;background:var(--panel);border-top:1px solid #232428;display:flex;gap:10px;align-items:center}
    .composer input[type="text"], .composer textarea{flex:1;background:var(--input);border:1px solid #2b2d31;padding:10px;border-radius:8px;color:var(--white);outline:none}
    .composer button{background:var(--accent);border:none;color:white;padding:10px 14px;border-radius:8px;cursor:pointer}

    /* right members */
    .members{width:220px;background:var(--panel);padding:14px;border-left:1px solid #232428;display:flex;flex-direction:column}
    .member{padding:8px;border-radius:6px;background:#333;margin-bottom:6px}

    /* mobile adjustments */
    @media(max-width:880px){.channels{display:none}.members{display:none}.servers{width:60px}.channels{width:0}}
  </style>
</head>
<body>
  <div class="servers">
    <div class="server">GC</div>
    <div class="server small">+</div>
  </div>

  <div class="channels" id="channelList">
    <div class="title">CHANNELS</div>
    <!-- channels will be populated by JS -->
    <div style="margin-top:6px;display:flex;gap:8px">
      <input id="newChannelInput" placeholder="New channel" style="flex:1;padding:8px;border-radius:6px;border:1px solid #232428;background:#26282b;color:var(--white)" />
      <button id="addChannelBtn" style="padding:8px 10px;border-radius:6px;border:none;background:var(--accent);color:#fff;cursor:pointer">Add</button>
    </div>
  </div>

  <div class="chat">
    <div class="header"><div style="font-weight:700" id="headerChannel"># general</div></div>

    <div class="messages" id="messages" aria-live="polite"></div>

    <div class="composer">
      <input id="messageInput" type="text" placeholder="Message #general — press Enter to send" autocomplete="off" />
      <button id="sendBtn">Send</button>
    </div>
  </div>

  <div class="members" id="members">
    <div style="font-weight:700;margin-bottom:8px">ONLINE</div>
    <!-- members populated by JS -->
  </div>

  <script>
    // === Simple working chat app (no server) ===
    // features: channel switching, enter-to-send, localStorage persistence, basic UI

    const defaultState = {
      channels: {
        general: { name: 'general', messages: [ {id: genId(), author: 'User1', text: 'Hello!', t: Date.now()}, {id: genId(), author: 'User2', text: 'Welcome — this is a local demo.', t: Date.now()} ] },
        chat: { name: 'chat', messages: [] },
        memes: { name: 'memes', messages: [] }
      },
      current: 'general',
      members: ['You','User1','User2']
    }

    function genId(){return Math.random().toString(36).slice(2,9)}

    function loadState(){
      try{const raw = localStorage.getItem('dc_demo_v1'); if(raw) return JSON.parse(raw)}catch(e){}
      return defaultState;
    }
    function saveState(){localStorage.setItem('dc_demo_v1', JSON.stringify(state))}

    let state = loadState();

    // elements
    const messagesEl = document.getElementById('messages');
    const headerEl = document.getElementById('headerChannel');
    const msgInput = document.getElementById('messageInput');
    const sendBtn = document.getElementById('sendBtn');
    const channelListEl = document.getElementById('channelList');
    const membersEl = document.getElementById('members');
    const newChannelInput = document.getElementById('newChannelInput');
    const addChannelBtn = document.getElementById('addChannelBtn');

    function renderChannels(){
      // remove existing channel buttons (except header and new channel controls)
      const existing = Array.from(channelListEl.querySelectorAll('.channel')); existing.forEach(e=>e.remove());
      const frag = document.createDocumentFragment();
      Object.keys(state.channels).forEach(key => {
        const ch = state.channels[key];
        const div = document.createElement('div');
        div.className = 'channel' + (state.current===key? ' active':'');
        div.textContent = '# ' + ch.name;
        div.dataset.key = key;
        div.addEventListener('click',()=>{ state.current = key; saveState(); render(); });
        frag.appendChild(div);
      });
      channelListEl.insertBefore(frag, channelListEl.children[1] || channelListEl.lastChild);
    }

    function renderMembers(){
      // clear previous member nodes except title
      const children = Array.from(membersEl.children).slice(0,1);
      membersEl.innerHTML = '';
      membersEl.appendChild(children[0]);
      state.members.forEach(m=>{
        const d = document.createElement('div'); d.className='member'; d.textContent = m; membersEl.appendChild(d);
      });
    }

    function renderMessages(){
      messagesEl.innerHTML='';
      const channel = state.channels[state.current];
      headerEl.textContent = '# ' + channel.name;
      channel.messages.forEach(m => {
        const row = document.createElement('div'); row.className = 'msg';
        const av = document.createElement('div'); av.className='avatar'; av.textContent = m.author.charAt(0).toUpperCase();
        const content = document.createElement('div');
        const meta = document.createElement('div'); meta.className='meta'; meta.textContent = m.author + ' • ' + new Date(m.t).toLocaleString();
        const bubble = document.createElement('div'); bubble.className='bubble'; bubble.textContent = m.text;
        content.appendChild(meta); content.appendChild(bubble);
        row.appendChild(av); row.appendChild(content);
        messagesEl.appendChild(row);
      });
      // scroll to bottom
      messagesEl.scrollTop = messagesEl.scrollHeight;
    }

    function render(){ renderChannels(); renderMessages(); renderMembers(); }

    // send message
    function sendMessage(){
      const txt = msgInput.value.trim(); if(!txt) return;
      const ch = state.channels[state.current];
      const m = { id: genId(), author: 'You', text: txt, t: Date.now() };
      ch.messages.push(m);
      msgInput.value=''; saveState(); renderMessages();
    }

    // create channel
    addChannelBtn.addEventListener('click', ()=>{
      const name = newChannelInput.value.trim(); if(!name) return; const key = name.toLowerCase().replace(/[^a-z0-9\-]/g,'-');
      if(state.channels[key]){ alert('Channel exists'); return; }
      state.channels[key] = { name, messages: [] }; state.current = key; newChannelInput.value=''; saveState(); render();
    });

    // send button & Enter key
    sendBtn.addEventListener('click', sendMessage);
    msgInput.addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ e.preventDefault(); sendMessage(); } });

    // initialize
    render();

    // expose for debugging
    window._dc_demo = { state, render, saveState };
  </script>
</body>
</html>
